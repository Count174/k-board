# CEO Dashboard ‚Äî –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## 1. Backend: API –º–µ—Ç—Ä–∏–∫

**–†–æ—É—Ç:** `GET /api/ceo/dashboard` (–∏–ª–∏ `/api/admin/dashboard`)

**–ó–∞—â–∏—Ç–∞:** –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-CEO-Secret` –∏–ª–∏ query `?secret=...` ‚Äî —Å–≤–µ—Ä–∫–∞ —Å `process.env.CEO_SECRET`. –ë–µ–∑ —Å–µ–∫—Ä–µ—Ç–∞ ‚Äî 401.

**–û—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä):**

```json
{
  "users": {
    "total": 150,
    "newToday": 2,
    "newThisWeek": 8,
    "newThisMonth": 25,
    "byDay": [{ "date": "2025-01-01", "count": 5, "cumulative": 120 }, ...]
  },
  "transactions": {
    "total": 12000,
    "today": 45,
    "thisMonth": 1100,
    "byDay": [{ "date": "2025-01-15", "count": 52 }, ...],
    "byMonth": [{ "month": "2025-01", "count": 900 }, ...]
  },
  "dauMau": {
    "dau": 18,
    "mau": 85,
    "ratio": 0.21,
    "source": "finance"  // –∏–ª–∏ "daily_checks" / "any"
  },
  "retention": {
    "day1": 0.45,
    "day7": 0.28,
    "day30": 0.15,
    "cohorts": [{ "signupDate": "2025-01-01", "day1": 0.5, "day7": 0.3 }, ...]
  },
  "engagement": {
    "avgTransactionsPerUser": 80,
    "pctUsersWithTxLast7d": 0.42,
    "pctUsersWithTxLast30d": 0.68,
    "pctUsersWithCheckinLast7d": 0.15
  }
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –Ω–æ–≤—ã–π `controllers/ceoController.js` + `routes/ceo.js`. –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î:

- –Æ–∑–µ—Ä—ã: `SELECT COUNT(*), date(created_at) ... FROM users GROUP BY date(created_at)` –∏ —Ç.–ø. (–µ—Å–ª–∏ –≤ `users` –µ—Å—Ç—å `created_at`; –∏–Ω–∞—á–µ ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–∏—Ç –∫–æ–ª–æ–Ω–∫—É).
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: —É–∂–µ –µ—Å—Ç—å `user_id`, `date` –≤ `finances` ‚Äî –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –¥–Ω—é/–º–µ—Å—è—Ü—É.
- DAU/MAU: —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ `user_id` –∑–∞ –¥–µ–Ω—å –∏–∑ `finances` (–∏–ª–∏ –∏–∑ `daily_checks` ‚Äî —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–µ–Ω—å = –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å).
- Retention: –∫–æ–≥–æ—Ä—Ç—ã –ø–æ `date(users.created_at)`, –∑–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–≥–æ—Ä—Ç—ã —Å—á–∏—Ç–∞–µ–º, —Å–∫–æ–ª—å–∫–æ —é–∑–µ—Ä–æ–≤ –∏–º–µ–ª–∏ —Ö–æ—Ç—è –±—ã 1 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–∏–ª–∏ —á–µ–∫–∏–Ω) –≤ day+1, day+7, day+30.
- Engagement: —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª-–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ —é–∑–µ—Ä–∞; –ø—Ä–æ—Ü–µ–Ω—Ç —é–∑–µ—Ä–æ–≤ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7/30 –¥–Ω–µ–π.

–ï—Å–ª–∏ –≤ `users` –Ω–µ—Ç `created_at` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë.

---

## 2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–ì–¥–µ:** –≤ `routes/auth.js` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `INSERT INTO users` (–≤ callback `db.run(..., function (err2) { ... })`).

**–õ–æ–≥–∏–∫–∞:**

- –ß–∏—Ç–∞—Ç—å `process.env.CEO_TELEGRAM_CHAT_ID` –∏ `process.env.TELEGRAM_BOT_TOKEN` (–∏–ª–∏ –∫–∞–∫ —É —Ç–µ–±—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –±–æ—Ç–∞).
- –ï—Å–ª–∏ –æ–±–∞ –∑–∞–¥–∞–Ω—ã ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∏–¥–∞:  
  `üÜï –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: name (email)` (–∏–ª–∏ —Ç–æ–ª—å–∫–æ email, –±–µ–∑ –ø–∞—Ä–æ–ª—è/—Ç–æ–∫–µ–Ω–æ–≤).
- –û—Ç–ø—Ä–∞–≤–∫—É –¥–µ–ª–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏): –Ω–∞–ø—Ä–∏–º–µ—Ä, `sendTelegramMessage(...).catch(() => {})` –∏–ª–∏ —á–µ—Ä–µ–∑ –º–∞–ª–µ–Ω—å–∫–∏–π helper –≤ `utils/telegramNotify.js`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–≥–∞–µ—Ç Telegram Bot API (https://api.telegram.org/bot<token>/sendMessage).

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** —Ç–æ–∫–µ–Ω –∏ chat_id —Ç–æ–ª—å–∫–æ –≤ .env, –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å.

---

## 3. Frontend: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ CEO Dashboard

- **–†–æ—É—Ç:** –Ω–∞–ø—Ä–∏–º–µ—Ä `/ceo` –∏–ª–∏ `/dashboard/ceo`.
- **–î–æ—Å—Ç—É–ø:** –ø–æ —Å–µ–∫—Ä–µ—Ç—É –≤ URL, –Ω–∞–ø—Ä–∏–º–µ—Ä `/ceo?secret=xxx`. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–µ–∫—Ä–µ—Ç –≤ `sessionStorage` (–∏–ª–∏ localStorage) –∏ –¥–∞–ª—å—à–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ API. –õ–∏–±–æ –æ–¥–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è ‚Äú—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞‚Äù –¥–ª—è CEO: –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è/—Å–µ–∫—Ä–µ—Ç–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º ‚Üí –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º.
- **–ó–∞–ø—Ä–æ—Å—ã:** `GET /api/ceo/dashboard` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `X-CEO-Secret: <secret>`.
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:** Recharts (—É–∂–µ –µ—Å—Ç—å):
  - –≥—Ä–∞—Ñ–∏–∫ ‚Äú–Æ–∑–µ—Ä—ã‚Äù (–ø–æ –¥–Ω—è–º, cumulative –∏–ª–∏ new per day);
  - –≥—Ä–∞—Ñ–∏–∫ ‚Äú–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏‚Äù (–≤ –¥–µ–Ω—å / –≤ –º–µ—Å—è—Ü);
  - –∫–∞—Ä—Ç–æ—á–∫–∏: DAU, MAU, DAU/MAU, –∫–æ–ª-–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤—Å–µ–≥–æ/—Å–µ–≥–æ–¥–Ω—è/–≤ –º–µ—Å—è—Ü–µ;
  - Retention: —Ç–∞–±–ª–∏—Ü–∞ –∏–ª–∏ bar chart (day1, day7, day30 –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º –∏–ª–∏ –≤ —Å—Ä–µ–¥–Ω–µ–º);
  - Engagement: –ø—Ä–æ—Ü–µ–Ω—Ç —é–∑–µ—Ä–æ–≤ —Å–æ —Å–≤–µ–∂–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª-–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ —é–∑–µ—Ä–∞.

–ú–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –±–ª–æ–∫–∏: ‚Äú–Æ–∑–µ—Ä—ã‚Äù, ‚Äú–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏‚Äù, ‚ÄúDAU/MAU‚Äù, ‚ÄúRetention‚Äù, ‚ÄúEngagement‚Äù.

---

## 4. –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç

1. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ): –¥–æ–±–∞–≤–∏—Ç—å `created_at` –≤ `users` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –ø–µ—Ä–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞).
2. **Backend:** `ceoController.js` + `routes/ceo.js` + –≤ `index.js` –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç, –∑–∞—â–∏—Ç–∞ –ø–æ `CEO_SECRET`.
3. **Telegram:** helper –æ—Ç–ø—Ä–∞–≤–∫–∏ + –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ `auth.js`.
4. **Frontend:** —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/ceo`, –ø–µ—Ä–µ–¥–∞—á–∞ —Å–µ–∫—Ä–µ—Ç–∞, –∑–∞–ø—Ä–æ—Å –∫ API, —Ä–∞–∑–º–µ—Ç–∫–∞ –±–ª–æ–∫–æ–≤ –∏ –≥—Ä–∞—Ñ–∏–∫–∏ Recharts.
5. **.env:** –¥–æ–±–∞–≤–∏—Ç—å `CEO_SECRET`, `CEO_TELEGRAM_CHAT_ID`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `TELEGRAM_BOT_TOKEN`.

---

## 6. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å–¥–µ–ª–∞–Ω–æ)

- **Backend:** `controllers/ceoController.js`, `routes/ceo.js`, –∑–∞—â–∏—Ç–∞ –ø–æ `X-CEO-Secret` –∏–ª–∏ `?secret=`.
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram:** –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç ‚Äî `utils/ceoTelegram.js`, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `CEO_TELEGRAM_BOT_TOKEN`, `CEO_TELEGRAM_CHAT_ID`. –í—ã–∑–æ–≤ `notifyNewUser(name, email)` –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ `routes/auth.js`.
- **Frontend:** —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/helicopter`, —Ç–æ–∫–µ–Ω –∏–∑ URL `?secret=...` –∏–ª–∏ —Ñ–æ—Ä–º–∞ –≤–≤–æ–¥–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `sessionStorage`. –ó–∞–ø—Ä–æ—Å –∫ `GET /api/ceo/dashboard` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `X-CEO-Secret`.
- **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î:** `db/migrate_ceo_users.js` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç `name` –∏ `created_at` –≤ `users` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):**

- `CEO_SECRET` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞—à–±–æ—Ä–¥—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è /helicopter –∏ /api/ceo/dashboard).
- `CEO_TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π CEO (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
- `CEO_TELEGRAM_CHAT_ID` ‚Äî ID —á–∞—Ç–∞, –∫—É–¥–∞ —Å–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —é–∑–µ—Ä–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

---

## 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)

- –ö–æ–Ω–≤–µ—Ä—Å–∏—è ‚Äú–∑–∞—Ä–µ–≥–∏–ª—Å—è ‚Üí –ø—Ä–∏–≤—è–∑–∞–ª Telegram‚Äù (–¥–æ–ª—è `users` —Å –∑–∞–ø–∏—Å—å—é –≤ `telegram_users`).
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Ç–∏–ø–∞–º (income/expense) –ø–æ –º–µ—Å—è—Ü–∞–º.
- –¢–æ–ø-N –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —é–∑–µ—Ä—É, –∞–≥—Ä–µ–≥–∞—Ç –ø–æ –≤—Å–µ–º).

–í—Å—ë —ç—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ç–æ—Ç –∂–µ `GET /api/ceo/dashboard` –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
